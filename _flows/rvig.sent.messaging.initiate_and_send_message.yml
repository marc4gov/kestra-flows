id: initiate_and_send_message
namespace: rvig.sent.messaging

variables:
  host: host.docker.internal

inputs:
  - id: instantie_van
    type: STRING
    defaults: "1810"
    required: true
  - id: instantie_naar
    type: STRING
    defaults: "1811"
    required: true
  - id: bericht
    type: JSON
    defaults: '{"PLnummer": "001", "context": "bijhouden", "code": "Ii01"}'
    required: false

tasks:
  - id: log_inputs
    type: io.kestra.core.tasks.log.Log
    message: '{{inputs.bericht}}'

  - id: initiate_message_exchange
    type: io.kestra.core.tasks.flows.Subflow
    namespace: rvig.sent.messaging
    flowId: initiate_message_exchange
    inputs:
      instantie_van: '{{ inputs.instantie_van}}'
      instantie_naar: '{{ inputs.instantie_naar}}'
      context: '{{ inputs.bericht.context }}'
  - id: send_message
    type: io.kestra.core.tasks.flows.Subflow
    namespace: rvig.sent.messaging
    flowId: send_message
    inputs:
      instantie_van: '{{ inputs.instantie_van}}'
      instantie_naar: '{{ inputs.instantie_naar}}'
      bericht: '{{ inputs.bericht}}'